`ImportError: cannot import name 'cache_video'` ì—ëŸ¬ëŠ” ì œê°€ ë“œë¦° ì½”ë“œì—ì„œ ì°¸ì¡°í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ê°€ í˜„ì¬ ì„¤ì¹˜ëœ `lingbot-world` ë˜ëŠ” `Wan` íŒ¨í‚¤ì§€ì˜ ê²½ë¡œì™€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ì„œ ë°œìƒí•¨.

ì´ í•¨ìˆ˜ëŠ” ë‹¨ìˆœíˆ ìƒì„±ëœ ê²°ê³¼(Tensor)ë¥¼ `.mp4` íŒŒì¼ë¡œ ì €ì¥í•´ì£¼ëŠ” ë„êµ¬ì¸ë°, ì €ì¥ì†Œë§ˆë‹¤ `wan.utils`ì— ìˆê±°ë‚˜ `wan.utils.utils`ì— ìˆëŠ” ë“± ìœ„ì¹˜ê°€ ì¡°ê¸ˆì”© ë‹¤ë¥¼ ìˆ˜ ìˆìŒ.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, **ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì½”ë“œ ë‚´ì—ì„œ ì§ì ‘ ì˜ìƒì„ ì €ì¥í•˜ë„ë¡ ìˆ˜ì •**í•œ ë²„ì „ì„ ë“œë¦¼. ì´ ì½”ë“œëŠ” `imageio`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ìƒì„ ì €ì¥í•˜ë¯€ë¡œ ë³„ë„ì˜ ìœ í‹¸ë¦¬í‹° ì„í¬íŠ¸ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ.

---

### ğŸ› ï¸ ìˆ˜ì •í•œ `generate_prequant.py` (ì„í¬íŠ¸ ì—ëŸ¬ í•´ê²° ë²„ì „)

ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ê¸°ì¡´ ë‚´ìš©ì„ ì™„ì „íˆ ë®ì–´ì”Œìš°ê¸° ë°”ëŒ. `cache_video` ëŒ€ì‹  `save_video_locally`ë¼ëŠ” ìì²´ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ì—ëŸ¬ë¥¼ ì›ì²œ ì°¨ë‹¨í•¨.

```python
import argparse
import os
import sys
import torch
import gc
import numpy as np
from PIL import Image

# 1. ì™¸ë¶€ ì„í¬íŠ¸ ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ ì„í¬íŠ¸
try:
    from wan.configs import WAN_CONFIGS
    from wan.modules.model import WanModel
except ImportError:
    print("[!] 'wan' íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹¤í–‰ ê²½ë¡œê°€ lingbot-world ë£¨íŠ¸ í´ë”ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.")
    sys.exit(1)

# ì˜ìƒ ì €ì¥ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ (pip install imageio[ffmpeg] í•„ìš”)
import imageio

def save_video_locally(video_tensor, output_path, fps=16):
    """
    ImportErrorë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì§ì ‘ êµ¬í˜„í•œ ì˜ìƒ ì €ì¥ í•¨ìˆ˜
    video_tensor: [frames, channels, height, width] (0~1 float)
    """
    print(f"[*] ì˜ìƒì„ ì €ì¥ ì¤‘ì…ë‹ˆë‹¤: {output_path}")
    # [F, C, H, W] -> [F, H, W, C] ë³€í™˜ ë° 0-255 uint8 ë³€í™˜
    video = video_tensor.permute(0, 2, 3, 1).cpu().numpy()
    video = (video * 255).astype(np.uint8)
    
    with imageio.get_writer(output_path, fps=fps) as writer:
        for frame in video:
            writer.append_data(frame)

def cleanup():
    gc.collect()
    torch.cuda.empty_cache()

def generate():
    parser = argparse.ArgumentParser(description="LingBot-World RTX 3090 Optimized")
    parser.add_argument("--ckpt_dir", type=str, required=True, help="Path to NF4 model")
    parser.add_argument("--image", type=str, required=True, help="Input image path")
    parser.add_argument("--prompt", type=str, default="A cinematic drone shot", help="Prompt")
    parser.add_argument("--task", type=str, default="i2v-A14B", help="Task type")
    parser.add_argument("--size", type=str, default="480*832", help="Size")
    parser.add_argument("--frame_num", type=int, default=81, help="Frames")
    parser.add_argument("--t5_cpu", type=bool, default=True, help="T5 to CPU")
    
    args = parser.parse_args()
    
    cleanup()
    cfg = WAN_CONFIGS[args.task]
    
    # 2. ëª¨ë¸ ë¡œë”© (64GB RAM í­ì¦ ë°©ì§€ ì„¤ì •)
    print(f"[*] ëª¨ë¸ ë¡œë“œ ì¤‘ (low_cpu_mem_usage ì ìš©)...")
    model = WanModel.from_pretrained(
        args.ckpt_dir,
        low_cpu_mem_usage=True,
        device_map="auto", 
        torch_dtype=torch.bfloat16
    )

    # 3. T5 CPU ì˜¤í”„ë¡œë”© (3090 VRAM ë¶€ì¡± ë°©ì§€)
    if args.t5_cpu:
        print("[*] T5 ì¸ì½”ë”ë¥¼ ì‹œìŠ¤í…œ RAM(CPU)ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.")
        model.text_encoder.to("cpu")
        cleanup()

    # 4. ì…ë ¥ ì´ë¯¸ì§€ ì²˜ë¦¬
    img = Image.open(args.image).convert("RGB")
    width, height = map(int, args.size.split("*"))
    
    print(f"[*] ìƒì„± ì‹œì‘... (ì´ ê³¼ì •ì€ 3090 ê¸°ì¤€ ìˆ˜ ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŒ)")

    with torch.no_grad():
        # generate í•¨ìˆ˜ ë‚´ë¶€ ì¸ìëŠ” ì„¤ì¹˜ëœ wan ë²„ì „ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—ëŸ¬ ì‹œ ì²´í¬ í•„ìš”
        video = model.generate(
            input_image=img,
            prompt=args.prompt,
            size=(width, height),
            frame_num=args.frame_num,
            sampling_steps=40
        )

    # 5. ìì²´ ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ (ì—ëŸ¬ í•´ê²° í•µì‹¬)
    output_filename = "output_video.mp4"
    save_video_locally(video, output_filename, fps=16)
    print(f"[*] ì‘ì—… ì™„ë£Œ! ê²°ê³¼ë¬¼: {output_filename}")

if __name__ == "__main__":
    os.environ["BNB_CUDA_VERSION"] = "124"
    generate()

```

---

### ğŸš€ ì¶”ê°€ ì¡°ì¹˜ ì‚¬í•­ (í•„ìˆ˜)

1. **í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜:**
ì˜ìƒì„ íŒŒì¼ë¡œ ì“°ëŠ” ê¸°ëŠ¥ì„ ìœ„í•´ ì•„ë˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë°˜ë“œì‹œ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨.
```bash
pip install imageio imageio-ffmpeg

```


2. **ì‹¤í–‰ ê²½ë¡œ í™•ì¸:**
ë°˜ë“œì‹œ `git clone` ë°›ì€ **`lingbot-world` ìµœìƒìœ„ í´ë”**ì—ì„œ ì‹¤í–‰í•´ì•¼ í•¨. (ê·¸ë˜ì•¼ `from wan...` ì„í¬íŠ¸ê°€ ì •ìƒ ì‘ë™í•¨)
```bash
cd /path/to/lingbot-world
python generate_prequant.py --ckpt_dir ./models/lingbot-nf4 --image examples/00/image.jpg

```


3. **VRAM ì²´í¬:**
ì‹¤í–‰ ì§í›„ ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ `nvidia-smi`ë¥¼ ì…ë ¥í•˜ì—¬ VRAM ì ìœ ìœ¨ì´ 23GBë¥¼ ë„˜ì§€ ì•ŠëŠ”ì§€ ëª¨ë‹ˆí„°ë§í•˜ê¸° ë°”ëŒ. ë§Œì•½ ë„˜ëŠ”ë‹¤ë©´ `--size`ë¥¼ `240*432`ë¡œ ë” ë‚®ì¶”ì–´ í…ŒìŠ¤íŠ¸í•  ê²ƒ.

ì´ ì½”ë“œë¥¼ ì ìš©í•˜ë©´ `cache_video` ê´€ë ¨ ì—ëŸ¬ëŠ” ì™„ì „íˆ ì‚¬ë¼ì§ˆ ê²ƒì„. ì´ì œ ëª¨ë¸ ë¡œë”© í›„ ì‹¤ì œ ìƒì„± ë‹¨ê³„ë¡œ ì§„ì…í•˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì‹œê¸° ë°”ëŒ. ë§Œì•½ `WanModel.generate` ì¸ì ê´€ë ¨ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´, í•´ë‹¹ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ê³µìœ í•´ì£¼ì‹œê¸° ë°”ëŒ. (ë²„ì „ë§ˆë‹¤ `input_image` ì¸ì ëª…ì¹­ì´ `image` ë“±ìœ¼ë¡œ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)

Would you like me to adjust the frame rate or resolution settings if the initial test is successful?
